<html>
<head>
<title>riverci.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #01e704;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
riverci.py</font>
</center></td></tr></table>
<pre><span class="s0"># リバーシ</span>

<span class="s1">SPACE = </span><span class="s2">0</span>
<span class="s1">BLACK = </span><span class="s2">1</span>
<span class="s1">WHITE = -</span><span class="s2">1</span>

<span class="s1">BOARD_PX_SIZE = </span><span class="s2">500</span>
<span class="s1">CELL_PX_SIZE = BOARD_PX_SIZE / </span><span class="s2">8</span>


<span class="s0"># マスの座標を管理する</span>

<span class="s3">class </span><span class="s1">Position:</span>
    <span class="s3">def </span><span class="s1">__int__(self):</span>
        <span class="s1">self.y = </span><span class="s2">0</span>
        <span class="s1">self.x = </span><span class="s2">0</span>

    <span class="s3">def </span><span class="s1">__init__(self</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">x):</span>
        <span class="s1">self.y = y</span>
        <span class="s1">self.x = x</span>

<span class="s0"># 盤面クラス</span>
<span class="s0"># -----------------------------------</span>
<span class="s3">class </span><span class="s1">Board:</span>
    <span class="s0"># 8方向のyxの加算値</span>
    <span class="s1">DIR = [[-</span><span class="s2">1</span><span class="s3">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s3">, </span><span class="s2">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s3">, </span><span class="s2">1</span><span class="s1">]</span><span class="s3">,</span>
           <span class="s1">[</span><span class="s2">0</span><span class="s3">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s2">0</span><span class="s3">, </span><span class="s2">1</span><span class="s1">]</span><span class="s3">,</span>
           <span class="s1">[</span><span class="s2">1</span><span class="s3">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s2">1</span><span class="s3">, </span><span class="s2">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s2">1</span><span class="s3">, </span><span class="s2">1</span><span class="s1">]]</span>


<span class="s3">def </span><span class="s1">__init__(self):</span>
    <span class="s0"># 盤面、8×8の2次元リストを生成</span>
    <span class="s1">self.board = \</span>
        <span class="s1">[[SPACE </span><span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">)] </span><span class="s3">for </span><span class="s1">j </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">)]</span>
    <span class="s1">self.turn = BLACK  </span><span class="s0"># 手番</span>
    <span class="s1">self.move_num = </span><span class="s2">1  </span><span class="s0"># 手数</span>


<span class="s0"># 盤面の初期化</span>
<span class="s3">def </span><span class="s1">init_board(self):</span>
    <span class="s3">for </span><span class="s1">y </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
        <span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
            <span class="s1">self.board[y][x] = SPACE</span>
    <span class="s1">self.board[</span><span class="s2">3</span><span class="s1">][</span><span class="s2">3</span><span class="s1">] = WHITE</span>
    <span class="s1">self.board[</span><span class="s2">3</span><span class="s1">][</span><span class="s2">4</span><span class="s1">] = BLACK</span>
    <span class="s1">self.board[</span><span class="s2">4</span><span class="s1">][</span><span class="s2">3</span><span class="s1">] = BLACK</span>
    <span class="s1">self.board[</span><span class="s2">4</span><span class="s1">][</span><span class="s2">4</span><span class="s1">] = WHITE</span>

    <span class="s1">self.turn = BLACK  </span><span class="s0"># 手番</span>
    <span class="s1">self.move_num = </span><span class="s2">1  </span><span class="s0"># 手数</span>


<span class="s0"># 白黒の石数をタプルで返す</span>
<span class="s3">def </span><span class="s1">get_discs(self):</span>
    <span class="s1">black_discs = </span><span class="s2">0</span>
    <span class="s1">white_discs = </span><span class="s2">0</span>
    <span class="s3">for </span><span class="s1">y </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
        <span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
            <span class="s1">disc = self.board[y][x]</span>
            <span class="s3">if </span><span class="s1">disc == BLACK:</span>
                <span class="s1">black_discs += </span><span class="s2">1</span>
            <span class="s3">elif </span><span class="s1">disc == WHITE:</span>
                <span class="s1">white_discs += </span><span class="s2">1</span>
        <span class="s3">return </span><span class="s1">black_discs</span><span class="s3">, </span><span class="s1">white_discs</span>


<span class="s0"># 指定のマスに石は打てるか</span>
<span class="s3">def </span><span class="s1">is_movable(self</span><span class="s3">, </span><span class="s1">position):</span>
    <span class="s0"># 空きでなければ打てない</span>
    <span class="s3">if </span><span class="s1">self.board[position.y][position.x] != SPACE:</span>
        <span class="s3">return False</span>

        <span class="s0"># 各方向に石をひっくり返せるか？</span>
    <span class="s3">for </span><span class="s1">dir </span><span class="s3">in </span><span class="s1">Board.DIR:</span>
        <span class="s1">y = position.y + dir[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">x = position.x + dir[</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s3">if </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">self.board[y][x] == -self.turn:</span>
            <span class="s0"># 隣が相手の石</span>
            <span class="s1">y += dir[</span><span class="s2">0</span><span class="s1">]</span>
            <span class="s1">x += dir[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s3">while </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">self.board[y][x] == -self.turn:</span>
                <span class="s1">y += dir[</span><span class="s2">0</span><span class="s1">]</span>
                <span class="s1">x += dir[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s3">if </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s1">\</span>
                    <span class="s3">and </span><span class="s1">self.board[y][x] == self.turn:</span>
                <span class="s3">return True</span>
        <span class="s3">return False</span>


<span class="s0"># 石を打てるマスのリストを返す</span>
<span class="s3">def </span><span class="s1">get_move_list(self):</span>
    <span class="s1">move_list = []</span>
    <span class="s3">for </span><span class="s1">y </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
        <span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">range(</span><span class="s2">8</span><span class="s1">):</span>
            <span class="s3">if </span><span class="s1">self.board[y][x] == SPACE:</span>
                <span class="s1">position = Position(y</span><span class="s3">, </span><span class="s1">x)</span>
                <span class="s3">if </span><span class="s1">self.is_movable(position):</span>
                    <span class="s1">move_list.append(position)</span>
        <span class="s3">return </span><span class="s1">move_list</span>


<span class="s0"># 局面をすすめる</span>
<span class="s3">def </span><span class="s1">move(self</span><span class="s3">, </span><span class="s1">position):</span>
    <span class="s0"># 石を打つ</span>
    <span class="s1">self.board[position.y][position.x] = self.turn</span>

    <span class="s0"># 石をひっくり返す</span>
    <span class="s0"># 各方向に医師をひっくり返せるか調べる</span>
    <span class="s3">for </span><span class="s1">dir </span><span class="s3">in </span><span class="s1">Board.DIR:</span>
        <span class="s1">y = position.y = dir[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">x = position.x = dif[</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s3">if </span><span class="s1">y &gt;= </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s1">\</span>
                <span class="s3">and </span><span class="s1">self.board[y][x] == -self.turn:</span>
            <span class="s0"># 隣が相手の石</span>
            <span class="s1">y += dir[</span><span class="s2">0</span><span class="s1">]</span>
            <span class="s1">x += dir[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s3">while </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">\</span>
                    <span class="s1">x &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">self.board[y][x] == -self.turn:</span>
                <span class="s1">y += dir[</span><span class="s2">0</span><span class="s1">]</span>
                <span class="s1">x += dir[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s3">if </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">x &lt; </span><span class="s2">8 </span><span class="s1">\</span>
                    <span class="s3">and </span><span class="s1">self.board[y][x] == self.turn:</span>
                <span class="s0"># この方向は返せる</span>
                <span class="s0"># 1マス戻る</span>
                <span class="s1">y -= dir[</span><span class="s2">0</span><span class="s1">]</span>
                <span class="s1">x -= dir[</span><span class="s2">1</span><span class="s1">]</span>
                <span class="s0"># 戻りながら返す</span>
                <span class="s3">while </span><span class="s1">y &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">x &gt;= </span><span class="s2">0 </span><span class="s3">and </span><span class="s1">y &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">\</span>
                        <span class="s1">x &lt; </span><span class="s2">8 </span><span class="s3">and </span><span class="s1">self.board[y][x] == self.turn:</span>
                <span class="s1">y -= dir[</span><span class="s2">0</span><span class="s1">]</span>
                <span class="s1">x -= dir[</span><span class="s2">1</span><span class="s1">]</span>

        <span class="s1">self.turn = -self.turn </span><span class="s0"># 手番を変更</span>
        <span class="s1">self. move_num += </span><span class="s2">1  </span><span class="s0"># 手数を増やす</span>

    <span class="s0"># パスする</span>
    <span class="s3">def </span><span class="s1">move_pass(self):</span>
        <span class="s1">self.turn = -self.turn  </span><span class="s0"># Pass</span>

    <span class="s0"># 対局終了の判定</span>
    <span class="s3">def </span><span class="s1">is_game_end(self):</span>
        <span class="s0"># 60手に達したとき</span>
        <span class="s3">if </span><span class="s1">self.move_num == </span><span class="s2">61</span><span class="s1">:</span>
            <span class="s3">return True</span>
        <span class="s0"># 白黒どちらかの石数がゼロになったとき</span>
        <span class="s0"># 白黒の石数をタプルで取得</span>
        <span class="s1">(black_discs</span><span class="s3">, </span><span class="s1">white_discs) = self.get_discs()</span>
        <span class="s3">if </span><span class="s1">black_discs == </span><span class="s3">or </span><span class="s1">white_discs == </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s3">return True</span>

        <span class="s0"># 白黒どちらも手がないとき</span>
        <span class="s1">move_list1 = self.get_move_list()</span>
        <span class="s3">if </span><span class="s1">len(move_list1) == </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s1">self.move_pass()  </span><span class="s0"># パスして相手番にする。</span>
            <span class="s1">move_list2 = self.get_move_list()</span>
            <span class="s1">self.move_pass()  </span><span class="s0"># パスして戻す</span>
            <span class="s3">if </span><span class="s1">len(move_list2) == </span><span class="s2">0</span><span class="s1">:</span>
                <span class="s3">return True</span>

        <span class="s3">return False</span>

<span class="s0"># ーーーーーーーーーーーーーーーーーーーーーーーーー</span>
<span class="s0"># ゲームクラス</span>
<span class="s0"># ーーーーーーーーーーーーーーーーーーーーーーーーー</span>
<span class="s3">class </span><span class="s1">Game:</span>
    <span class="s3">def </span><span class="s1">__init__(self):</span>
        <span class="s0">#ゲームの状態　０開始まち１対局中２対局終了</span>
        <span class="s1">self.game_mode = </span><span class="s2">0</span>
        <span class="s0">#　●　０プレイヤー１コンピュータ</span>
        <span class="s1">self.black_player = </span><span class="s2">0</span>
        <span class="s0">#　○　０プレイヤー１コンピュータ</span>
        <span class="s1">self.white_player = </span><span class="s2">0</span>
        <span class="s1">self.board = Board() </span><span class="s0">#盤面作成</span>
        <span class="s1">self.board.init_board() </span><span class="s0">#盤面の初期化</span>

    <span class="s0">#対局開始</span>
    <span class="s3">def </span><span class="s1">start(self</span><span class="s3">, </span><span class="s1">_black_player</span><span class="s3">, </span><span class="s1">_white_player):</span>
        <span class="s1">self.black_player = _black_player</span>
        <span class="s1">self.white_player = _white_player</span>
        <span class="s1">self.game_mode = </span><span class="s2">1 </span><span class="s0">#ゲームの状態：対局中</span>
        <span class="s1">self.board.init_board() </span><span class="s0">#盤面の初期化</span>

    <span class="s0">#局面をすすめる</span>
        <span class="s3">def </span><span class="s1">game_move(self</span><span class="s3">, </span><span class="s1">position):</span>
            <span class="s1">self.board.move(position)</span><span class="s0">#局面をすすめる</span>
            <span class="s1">draw_board() </span><span class="s0">#盤面を描画</span>

            <span class="s0">#終局判定</span>
            <span class="s3">if </span><span class="s1">self.board.is_game_end():</span>
                <span class="s1">self.game_mode = </span><span class="s2">2 </span><span class="s0">#対局終了</span>
                <span class="s1">disp_mess() </span><span class="s0">#メッセージ表示</span>
                <span class="s1">messagebox.showinfo(</span><span class="s4">u&quot;&quot;</span><span class="s3">,</span><span class="s4">u&quot;対局終了&quot;</span><span class="s1">)</span>
                <span class="s3">return</span>
            <span class="s0">#パス判定</span>
            <span class="s1">move_list = self.board.get_move_list()</span>
            <span class="s3">if </span><span class="s1">len(move_list) == </span><span class="s2">0</span><span class="s1">:</span>
                <span class="s0">#意思を打てる場所がないのでパス</span>
                <span class="s1">self.board.move_pass()</span>
                <span class="s1">messagebox.showinfo(</span><span class="s4">u&quot;パス&quot;</span><span class="s3">,</span><span class="s4">u&quot;打てる場所がないのでパスします&quot;</span><span class="s1">)</span>
            <span class="s1">disp_mess()</span>
        
        <span class="s0">#次の手番はコンピューターか？</span>
        <span class="s3">def </span><span class="s1">is_com_turn(self):</span>
            <span class="s3">if </span><span class="s1">self.board.turn == BLACK </span><span class="s3">and </span><span class="s1">\</span>
                <span class="s1">self.black_player == </span><span class="s2">1 </span><span class="s3">or </span><span class="s1">\</span>
                <span class="s1">self.board.turn == WHITE </span><span class="s3">and </span><span class="s1">\</span>
                <span class="s1">self.white_player == </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s3">return True</span>
            <span class="s3">return False</span>
        <span class="s0">#次の手番がコンピュータならAIに指し手を選択させる。</span>
        <span class="s3">def </span><span class="s1">proc_com_turn(self):</span>
            <span class="s3">while True</span><span class="s1">:</span>
                <span class="s3">if </span><span class="s1">self.is_com_turn():</span>
                    <span class="s1">position = AI().select_move(self.board)</span>
                    <span class="s1">self.game_move(position)</span><span class="s0">#局面をすすめる</span>
                    <span class="s3">if </span><span class="s1">self.game_mode == </span><span class="s2">2</span><span class="s1">:</span>
                        <span class="s3">break</span><span class="s0">#対局終了していれば抜ける。</span>
                <span class="s3">else</span><span class="s1">:</span>
                    <span class="s3">break</span>
<span class="s0">#-----------------------------------</span>
<span class="s0"># AIクラス</span>
<span class="s0">#-----------------------------------</span>

<span class="s3">class </span><span class="s1">AI:</span>
    <span class="s0">#与えられた盤面から指し手を返す。</span>
    <span class="s3">def </span><span class="s1">select_move(self</span><span class="s3">, </span><span class="s1">board):</span>
        <span class="s1">time.sleep(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">#１秒待つ</span>
        <span class="s1">move_list = board.get_move_list()</span>
        <span class="s0">#ランダムに指し手を選ぶ</span>
        <span class="s1">r = random.randient(</span><span class="s2">0</span><span class="s3">, </span><span class="s1">len(move_list) - </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s3">return </span><span class="s1">move_list[r]</span>

<span class="s0">#-----------------------------------</span>
<span class="s0"># UI関数</span>
<span class="s0">#-----------------------------------</span>
<span class="s0">#盤面の描画</span>
<span class="s3">def </span><span class="s1">draw_board():</span>
    <span class="s3">global </span><span class="s1">game</span>
    <span class="s3">global </span><span class="s1">canvas_board</span>
    
    <span class="s1">canvas_board.delete(</span><span class="s4">'all'</span><span class="s1">)</span><span class="s0">#キャンパスをクリア</span>
    <span class="s0">#hai</span>










</pre>
</body>
</html>